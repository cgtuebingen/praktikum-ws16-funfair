<html>

    <head>
        <title>Highstriker</title>
    </head>

    <body style="background:#ebe3d9;margin:0">

        <div style="position: relative; width:80%; margin:auto"> 
            <img src="../../design/bude_bg.svg" style="position: absolute; z-index: 1; width: 100%">

            <img src="../../design/bude_fg_highstriker.svg" style="position: absolute; z-index: 3; width: 100%">
            <div style="position: relative; z-index: 2"> <canvas id="canvas"></canvas></div>

        </div>

        <script src="../js/common.js"></script>
        <script>


            var canvas = $("#canvas");
            canvas[0].width = window.innerWidth;
            canvas[0].height = window.innerHeight;
            var ctx = canvas.getContext("2d");
            var off = canvas.offset(); // get the offset of the canvas once

            var col_red   = "rgb(165, 30, 55)";
            var col_bar      = "rgb(0, 105, 170)";
            var col_surrounding = "rgb(50, 65, 75)";
            var col_yellow = "rgb(210, 150, 0)";
  
            var levels = ["Burnout candidate", 
                          "Amateur Yogi", 
                          "Meditation junkie",
                          "Yoga expert", 
                          "Master of Yoga"];
            var numLevels = levels.length;

            var width;
            var height;
            var offsetX;
            var offsetY;
            var surroundingWidth;
            var textPx;

            var barStartValue = 0.05;
            var bar = barStartValue;
        

            initialize = function() {

                width = window.innerWidth / 13;
                height = window.innerWidth / 5;
                offsetX = window.innerWidth / 2.3;
                offsetY = window.innerWidth / 4;
                surroundingWidth = window.innerWidth / 185;
                textPx = Math.trunc(window.innerWidth / 71);
                
                drawHighstriker(bar);

            }

            drawHighstriker = function(barHeightProportion) {
            /* barHeightProportion: \in [0, 1], denoting height of bar.
               The higher this is, the better for the striker.*/


                barHeightProportion = Math.max(barStartValue, barHeightProportion);
                barHeightProportion = Math.min(1.0, barHeightProportion); 

                // big middle rectangle
                ctx.fillStyle = col_red;
                ctx.fillRect(offsetX, offsetY, width, height);

                // surrounding
                ctx.strokeStyle = col_surrounding;
                ctx.lineWidth=surroundingWidth;
                ctx.strokeRect(offsetX, offsetY, width, height);


                // bar background
                ctx.fillStyle = col_yellow;
                var barBackgroundWidth  = (1/3) * (width-2*surroundingWidth);
                ctx.fillRect(offsetX + 0.5*width - 0.5*barBackgroundWidth,
                             offsetY,
                             barBackgroundWidth, height);

                // bar
                ctx.fillStyle = col_bar;
                var barWidth  = (1/6) * (width-2*surroundingWidth);
                var barHeight = barHeightProportion * height;
                ctx.fillRect(offsetX + 0.5*width - 0.5*barWidth,
                             offsetY+height-barHeight,
                             barWidth,
                             barHeight);
                // middle lines
                ctx.strokeStyle = col_surrounding;
                for(var i=0; i<=numLevels; i++) {
                    ctx.beginPath();
                    ctx.moveTo(offsetX, offsetY+i*(height / numLevels));
                    ctx.lineWidth = surroundingWidth;
                    ctx.lineTo(offsetX + width, offsetY+i*(height / numLevels));
                    ctx.stroke();
                }

                // YOGA levels
                ctx.font=String(textPx)+"px Georgia";

                var ellipseCenterX = offsetX-window.innerWidth/7.2;
                var ellipseWidth = window.innerWidth / 11;
                var ellipseHeight = window.innerWidth / 74;

                // strings for the level indicators
                ctx.beginPath();
                ctx.moveTo(ellipseCenterX-0.45*ellipseWidth, offsetY / 2);
                ctx.lineWidth = surroundingWidth*2;
                ctx.lineTo(ellipseCenterX-0.45*ellipseWidth, offsetY * 1.7);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(ellipseCenterX+0.45*ellipseWidth, offsetY / 2);
                ctx.lineWidth = surroundingWidth*2;
                ctx.lineTo(ellipseCenterX+0.45*ellipseWidth, offsetY * 1.7);
                ctx.stroke();

                for(var i=0; i<numLevels; i++) {

                    if(barHeightProportion*numLevels >= (numLevels-i-1)) {
                        var y = offsetY+i*(height / numLevels) +0.5*(height/numLevels);
                        var ellipseCenterY = y - window.innerWidth / 185;
                        // elliptic level indicator
                        drawEllipse(ctx, ellipseCenterX, ellipseCenterY,
                                    ellipseWidth, ellipseHeight,
                                    col_red, col_surrounding);
                                     
                        // level text: "Master of Yoga" etc
                        ctx.fillStyle = col_yellow;
                        ctx.fillText(levels[numLevels-i-1], 
                                     offsetX-window.innerWidth/5,
                                     y);
                    }
                }
            }

            initialize();

            /*#########################################################
                     ACTION HANDLING
            ########################################################*/
            window.onresize = function() {
                canvas[0].width = window.innerWidth;
                canvas[0].height = window.innerHeight;
                
                initialize();
            }


            // TODO delete this: for demonstration purpose only
            document.onmousemove = function(ev) {
                bar += 0.003;
                initialize();
            }


            /*#########################################################
                     DRAWING FUNCTIONS
            #########################################################*/

            function drawCylinder(ctx, x, y,
                                  height, radiusX, radiusY,
                                  col1, col2, colStroke) {

                drawEllipse(ctx, x, y+height,
                            radiusX, radiusY, col1, colStroke);

                drawEllipse(ctx, x, y-height,
                            radiusX, radiusY,
                            col2, colStroke);
            }

            function drawEllipse(ctx, x, y,
                                 radiusX, radiusY,
                                 col, colStroke) {

                ctx.beginPath();
                ctx.fillStyle = col;
                ctx.ellipse(x, y, 
                            radiusX = radiusX,
                            radiusY = radiusY,
                            rotation = 0,
                            startAngle = 0, 
                            endAngle = 2 * Math.PI);
                ctx.strokeStyle = colStroke;
                ctx.stroke();
                ctx.fill();
                ctx.closePath();
            }

        </script>

    </body>
</html>
